version: 0.2
env:
    git-credential-helper: yes
phases:
    install:
      runtime-versions:
        python: 3.9
      commands:
        - pwd
        - ls
        - python -m pip install --upgrade aws-sam-cli
        - python -m pip install pyOpenSSL --upgrade
        - sam --version
    build:
      commands:
        - echo Building test ...
    post_build:
      commands:
        - sam build -t ${SAM_TEMPLATE} --region ${REGION}
        - sam package --s3-bucket $ARTIFACT_BUCKET --image-repository $ECR_REPOSITORY --region $REGION --output-template-file packaged.yaml

      commands:
        - echo "SAM_TEMPLATE: ${SAM_TEMPLATE}, REGION: ${REGION}"
        - sam build -t ${SAM_TEMPLATE} --region ${REGION}

    
artifacts:
  files:
    - packaged.yaml
    - '**/*'